<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stream &mdash; MLX Data 0.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mlx.data.stream_csv_reader" href="_autosummary/mlx.data.stream_csv_reader.html" />
    <link rel="prev" title="mlx.data.Buffer.to_stream" href="_autosummary/mlx.data.Buffer.to_stream.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MLX Data
          </a>
              <div class="version">
                0.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Build and Install</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../buffers_streams_samples.html">Buffers, Streams and Samples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Common operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="buffer.html">Buffer</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stream</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#factory-methods">Factory methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.stream_csv_reader.html">mlx.data.stream_csv_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.stream_csv_reader_from_string.html">mlx.data.stream_csv_reader_from_string</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.stream_line_reader.html">mlx.data.stream_line_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.stream_python_iterable.html">mlx.data.stream_python_iterable</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stream-specific-api">Stream specific API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.csv_reader_from_key.html">mlx.data.Stream.csv_reader_from_key</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.line_reader_from_key.html">mlx.data.Stream.line_reader_from_key</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.dynamic_batch.html">mlx.data.Stream.dynamic_batch</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.partition.html">mlx.data.Stream.partition</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.buffered.html">mlx.data.Stream.buffered</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.repeat.html">mlx.data.Stream.repeat</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.shuffle.html">mlx.data.Stream.shuffle</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.sliding_window.html">mlx.data.Stream.sliding_window</a></li>
<li class="toctree-l3"><a class="reference internal" href="_autosummary/mlx.data.Stream.prefetch.html">mlx.data.Stream.prefetch</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common_datasets.html">Common Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="tokenizing.html">Tokenizing with MLX data</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Feature extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="miscellaneous.html">Miscellaneous</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MLX Data</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Stream</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/python/stream.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="stream">
<span id="id1"></span><h1>Stream<a class="headerlink" href="#stream" title="Permalink to this headline"></a></h1>
<p>Using a <code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code> in python should feel like accessing an iterator of
samples. Only the next sample can be fetched and the iteration may be restarted
depending on the underlying source of the data (some trully online sources are
not resettable).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlx.data</span> <span class="k">as</span> <span class="nn">dx</span>

<span class="c1"># The samples are never all instantiated</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="n">dx</span><span class="o">.</span><span class="n">stream_python_iterable</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)))</span>

<span class="c1"># Filtering is done with transforms returning an empty sample</span>
<span class="n">evens</span> <span class="o">=</span> <span class="n">numbers</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
<span class="c1"># prints {&#39;x&#39;: array(0)}</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
<span class="c1"># prints {&#39;x&#39;: array(1)}</span>

<span class="c1"># Streams are pointers to the streams so evens is using numbers under the</span>
<span class="c1"># hood. Since numbers was advanced now evens is advanced as well.</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">evens</span><span class="p">))</span>
<span class="c1"># prints {&#39;x&#39;: array(2)}</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">evens</span><span class="p">))</span>
<span class="c1"># prints {&#39;x&#39;: array(4)}</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
<span class="c1"># prints {&#39;x&#39;: array(5)}</span>

<span class="c1"># Streams can be reset.</span>
<span class="n">evens</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">evens</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">evens</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
<span class="c1"># prints {&#39;x&#39;: array(0)}</span>
<span class="c1">#        {&#39;x&#39;: array(2)}</span>
<span class="c1">#        {&#39;x&#39;: array(3)}</span>
</pre></div>
</div>
<div class="section" id="factory-methods">
<h2>Factory methods<a class="headerlink" href="#factory-methods" title="Permalink to this headline"></a></h2>
<p>We provide the following factory methods to create a stream. When used from
python the most interesting one is probably <a class="reference internal" href="_autosummary/mlx.data.stream_python_iterable.html#mlx.data.stream_python_iterable" title="mlx.data.stream_python_iterable"><code class="xref py py-func docutils literal notranslate"><span class="pre">stream_python_iterable()</span></code></a>. Of
course another good strategy is to start from a <code class="xref py py-class docutils literal notranslate"><span class="pre">Buffer</span></code> that you then
cast to a stream using <a class="reference internal" href="_autosummary/mlx.data.Buffer.to_stream.html#mlx.data.Buffer.to_stream" title="mlx.data.Buffer.to_stream"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Buffer.to_stream()</span></code></a>.</p>
<table class="autosummary longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/mlx.data.stream_csv_reader.html#mlx.data.stream_csv_reader" title="mlx.data.stream_csv_reader"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stream_csv_reader</span></code></a>(file, sep, quote, *, ...)</p></td>
<td><p>Stream samples from a csv file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="_autosummary/mlx.data.stream_csv_reader_from_string.html#mlx.data.stream_csv_reader_from_string" title="mlx.data.stream_csv_reader_from_string"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stream_csv_reader_from_string</span></code></a>(content[, ...])</p></td>
<td><p>Stream samples from a csv file provided as a string.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/mlx.data.stream_line_reader.html#mlx.data.stream_line_reader" title="mlx.data.stream_line_reader"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stream_line_reader</span></code></a>(file, key, unzip, *, ...)</p></td>
<td><p>Stream lines from a file.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="_autosummary/mlx.data.stream_python_iterable.html#mlx.data.stream_python_iterable" title="mlx.data.stream_python_iterable"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stream_python_iterable</span></code></a>(iterable_factory)</p></td>
<td><p>Stream samples from a python iterable.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="stream-specific-api">
<h2>Stream specific API<a class="headerlink" href="#stream-specific-api" title="Permalink to this headline"></a></h2>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code> has a more powerful API than <code class="xref py py-class docutils literal notranslate"><span class="pre">Buffer</span></code>. It does not allow
for random access, however, it allows for stream composing and prefetching.
Stream composing is when a sample becomes the beginning of a new stream that
can have arbitrary length.</p>
<p>Streams also allow for filtering using the provided functions or a
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Stream.sample_transform()</span></code> that returns an empty dictionary (an empty
Sample).</p>
<table class="autosummary longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.csv_reader_from_key.html#mlx.data.Stream.csv_reader_from_key" title="mlx.data.Stream.csv_reader_from_key"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.csv_reader_from_key</span></code></a>(self, key, sep, ...)</p></td>
<td><p>Read the csv file pointed to from the array at <code class="docutils literal notranslate"><span class="pre">key</span></code> and yield the contents as separate samples in the stream.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.line_reader_from_key.html#mlx.data.Stream.line_reader_from_key" title="mlx.data.Stream.line_reader_from_key"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.line_reader_from_key</span></code></a>(self, key, ...)</p></td>
<td><p>Read the file pointed to from the array at <code class="docutils literal notranslate"><span class="pre">key</span></code> and yield the lines as separate samples in the stream in the <code class="docutils literal notranslate"><span class="pre">dst_key</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.dynamic_batch.html#mlx.data.Stream.dynamic_batch" title="mlx.data.Stream.dynamic_batch"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.dynamic_batch</span></code></a>(self, buffer_size, key)</p></td>
<td><p>Dynamic batching returns batches with approximately the same number of total elements.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.partition.html#mlx.data.Stream.partition" title="mlx.data.Stream.partition"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.partition</span></code></a>(self, num_partitions, partition)</p></td>
<td><p>For every <code class="docutils literal notranslate"><span class="pre">num_partitions</span></code> consecutive samples return the <code class="docutils literal notranslate"><span class="pre">partition</span></code>-th.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.buffered.html#mlx.data.Stream.buffered" title="mlx.data.Stream.buffered"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.buffered</span></code></a>(self, buffer_size, ...)</p></td>
<td><p>Gather a buffer of samples, apply a function on the buffer and then iterate over the buffer samples.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.repeat.html#mlx.data.Stream.repeat" title="mlx.data.Stream.repeat"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.repeat</span></code></a>(self, num_time)</p></td>
<td><p>Reset the stream <code class="docutils literal notranslate"><span class="pre">num_time</span></code> times before declaring it exhausted.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.shuffle.html#mlx.data.Stream.shuffle" title="mlx.data.Stream.shuffle"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.shuffle</span></code></a>(self, buffer_size)</p></td>
<td><p>Shuffle the contents of the stream using a shuffle buffer.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.sliding_window.html#mlx.data.Stream.sliding_window" title="mlx.data.Stream.sliding_window"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.sliding_window</span></code></a>(self, key, size, stride)</p></td>
<td><p>Creates sample by sliding a window over the array at <code class="docutils literal notranslate"><span class="pre">key</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/mlx.data.Stream.prefetch.html#mlx.data.Stream.prefetch" title="mlx.data.Stream.prefetch"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Stream.prefetch</span></code></a>(self, prefetch_size, num_threads)</p></td>
<td><p>Fetch samples in background threads.</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="_autosummary/mlx.data.Buffer.to_stream.html" class="btn btn-neutral float-left" title="mlx.data.Buffer.to_stream" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="_autosummary/mlx.data.stream_csv_reader.html" class="btn btn-neutral float-right" title="mlx.data.stream_csv_reader" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, MLX Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>